{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block head_title %}{{ instance.title }} | {{ block.super }}{% endblock head_title %}

{% block style %}
.media-container {
    position: relative;
    width: 100%;
    max-width: 400px; /* or any fixed size */
    overflow: hidden;
    border: 1px solid #ccc;
    border-radius: 8px;
}
.media-container img,
.media-container video {
    width: 100%;
    object-fit: cover; /* crop to fill container while maintaining aspect */
    display: block;
}
.video-container {
    position: relative;
    width: 100%;
    max-width: 560px; /* Optional: limits size */
    padding-top: 100%; /* 1:1 Aspect Ratio (height = width) */
}

.video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
}
{% endblock style %}

{% block content %}
<main class="container mt-3">
<div class='col-sm-8 col-sm-offset-3'>
	{% if instance.media_url %}
	<div class="media-container">
		{% if instance.media_type == "image" %}
		<img src="https://raw.githubusercontent.com/tenctech10c/Images/main/{{ instance.media_url }}" alt="Media">
		{% elif instance.media_type == "video" %}
		<video controls>
			<source src="https://raw.githubusercontent.com/tenctech10c/Videos/main/{{ instance.media_url }}" type="video/mp4">
			Your browser does not support the video tag.
		</video>
		{% elif instance.media_type == "youtube" %}
			<div class="video-container">
				<iframe 
					src="https://www.youtube.com/embed/{{ instance.media_url }}"
					frameborder="0"
					allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
					allowfullscreen>
				</iframe>
			</div>
		{% else %}
			<p>Unsupported media type</p>
		{% endif %}
	</div>
	{% endif %}
	<h1>{{ instance.title }} 
		<small> 
			{% if instance.draft %}
				<span style='color:red'>Draft</span>
			{% endif %} 
		</small>
	</h1>

	{% if instance.user.get_full_name %}
		<p>Author: {{ instance.user.get_full_name }} </p>
	{% else %}
		<p>Author: {{ instance.user }} </p>
	{% endif %}
	<p>
	Published: {{ instance.publish }} 
	</p>

	<hr />
	<div class='row'>
		<div class='col-sm-12'>
		{% if instance.is_html %}
		<div class='content-markdown'>{{ instance.content|linebreaks|safe }}</div>
		{% else %}
		<div class='post-detail-item'>{{ instance.get_markdown }}</div>
		{% endif %}
		<!-- {{ instance.comments.all }} -->
		<hr /><br />
		<div>
			
			<p class='lead'>Comments</p>
			{% if request.user.is_authenticated %}
			<form method='POST' action=''>
			 	{% csrf_token %}
				{{ comment_form|crispy }}
				<br/>
				<input type='submit' value='Post comment' class='btn btn-default'>
			</form>
			{% else %}
			<p>You must login to comment </p>
			{% endif %}
			<hr />
			{% for comment in comments %}
				<!-- 	#Post Details will be diplayed using comment object
						{{ comment.content_object }} 
						{{ comment.content_object.get_markdown }} -->
				
				<blockquote class="blockquote">
				  	<p class="mb-0">{{ comment.content }}</p>
				  	<footer class="blockquote-footer">via {{ comment.user }} | {{ comment.timestamp|timesince }} ago  
				  	{% if comment.children.count > 0 %}| {{ comment.children.count }} Comment{% elif comment.children.count > 1 %}s {% endif %} |
			    	<button type="button" class="comment-reply-btn btn btn-default">Reply</button> |
			    	<a href='{{ comment.get_absolute_url }}'>Thread</a>
			    	</footer>
			    	<div class='comment-reply' style='display:none;'>
				    	{% for child_comment in comment.children %}
				    	<blockquote class="blockquote">
						  	<p class="mb-0">{{ child_comment.content }}</p>
						  	<footer class="blockquote-footer">via {{ child_comment.user }} | {{ child_comment.timestamp|timesince }} ago</footer>
				    	</blockquote>
				    	{% endfor %}
				    	
				    	{% if request.user.is_authenticated %}
				    	<form method='POST' action=''>
						 	{% csrf_token %}
							{{ comment_form|crispy }}
							<br/>
							<input type='hidden' name='parent_id' value='{{ comment.id }}'>
							<input type='submit' value='Reply' class='btn btn-default'>
						</form>	
						{% else %}
						<p>You must login to comment </p>
						{% endif %}
					</div>
				</blockquote>
				<hr/>
			{% endfor %}
		</div>
		</div>
	</div>
</div>
</main>
{% endblock content %}