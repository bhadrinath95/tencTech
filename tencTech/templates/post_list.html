{% extends "base.html" %}

{% block style %}
.media-container {
    position: relative;
    width: 100%;
    max-width: 400px; /* or any fixed size */
    aspect-ratio: 1 / 1; /* ensures square shape */
    overflow: hidden;
    border: 1px solid #ccc;
    border-radius: 8px;
}
.media-container img,
.media-container video {
    width: 100%;
    height: 100%;
    object-fit: cover; /* crop to fill container while maintaining aspect */
    display: block;
}
.video-container {
    position: relative;
    width: 100%;
    max-width: 560px; /* Optional: limits size */
    padding-top: 100%; /* 1:1 Aspect Ratio (height = width) */
}

.video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}
{% endblock style %}

{% block content %}

<main class="container mt-3">
<div class='col-sm-6 col-sm-offset-3'>
<h1>Blogs</h1>
<form class='row' method='GET' action=''>
	<div class='col-sm-6'>
		<div class='input-group'>
			<input class='form-control' type='text' name='query' placeholder='Search posts' value='{{ request.GET.query }}'/>
			<span class='input-group-btn'> 
				<button class='btn btn-default' type='submit'><i class='fa fa-search'></i></button>
			</span>
		</div>
	</div>
</form>
<br />
<div class="row">
{% for obj in object_list %}
<div class="col-sm-12"> <!-- column 1 -->
	<div class="thumbnail"> <!--  thumbnail 1  -->
		{% if obj.media_url %}
		<div class="media-container">
			{% if obj.media_type == "image" %}
			<img src="https://raw.githubusercontent.com/tenctech10c/Images/main/{{ obj.media_url }}" alt="Media">
			{% elif obj.media_type == "video" %}
			<video controls>
				<source src="https://raw.githubusercontent.com/tenctech10c/Videos/main/{{ obj.media_url }}" type="video/mp4">
				Your browser does not support the video tag.
			</video>
			{% elif obj.media_type == "youtube" %}
				<div class="video-container">
					<iframe 
						src="https://www.youtube.com/embed/{{ obj.media_url }}"
						frameborder="0"
						allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
						allowfullscreen>
					</iframe>
				</div>
			{% else %}
				<p>Unsupported media type</p>
			{% endif %}
		</div>
		{% endif %}
		<div class="caption post-detail-item"> <!-- caption -->
			{% if obj.draft %}<span style='color:red'><h3>Staff only: Draft </h3>{% if obj.publish > today %}<h3>Staff only: Future Post</h3>{% endif %}</span>{% endif %} 
			<h3><a href='{% url "posts:detail" obj.id %}'>{{ obj.title }}</a><small> {{ obj.publish }} <!-- obj.publish |timesince --> </small></h3>
			{% if obj.user.get_full_name %}
			<p>Author: {{ obj.user.get_full_name }} </p>
			{% else %}
			<p>Author: {{ obj.user }} </p>
			{% endif %}

			{% if instance.is_html %}
			<p class='content-markdown'>
				{{ obj.content | linebreaks | safe | truncatechars:120 }}
			</p>
			{% else %}
			{{ obj.get_markdown | truncatechars_html:120 }}
			{% endif %}
			<p><a href='{% url "posts:detail" obj.id %}' class="btn btn-primary" role="button">View</a></p>  
		</div>
	</div>
	<hr />
</div>

<!-- {% cycle "" "</div><div class='col-sm-12'><hr /></div><div class='row'>"%} -->
{% endfor %}

<div class="pagination">
	<span class="step-links">
		{% if object_list.has_previous %}
			<a href='?{{ page_request_var }}={{ object_list.previous_page_number }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}'>Previous</a>
		{% endif %}
		
		<span class="current">
			Page {{ object_list.number }} of {{ object_list.paginator.num_pages }}.
		</span>
		
		{% if object_list.has_next %}
            <a href="?{{ page_request_var }}={{ object_list.next_page_number }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}">Next</a>
        {% endif %}
	</span>
</div>

</div>
</div>
</main>
{% endblock content %}